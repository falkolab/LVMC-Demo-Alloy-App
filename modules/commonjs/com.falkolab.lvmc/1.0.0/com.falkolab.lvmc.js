function setAddMarker(e,t,r,n){var i=t.sections[r.sectionIndex];n=n||i.columns,n&&(r={sectionIndex:r.sectionIndex,itemIndex:Math.floor(r.itemIndex/n)}),t[e](r)}function printDebug(e,t){if("development"==Ti.App.deployType){var r=Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,t);r.write(JSON.stringify(e,null,"	")),r=null}}function clone(e){var t,r=Array.prototype.slice.call(arguments,1);if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,i=e.length;i>n;n++)t[n]=clone.apply(null,[e[n]].concat(r));return t}if(e instanceof Object){t={};for(var o in e)r&&r.indexOf(o)>=0||e.hasOwnProperty(o)&&(t[o]=clone.apply(null,[e[o]].concat(r)));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}function validateNotTransformedItems(e){_.each(e,function(e){if(e.template&&0===e.template.lastIndexOf("extlist@",0))throw"Probably you use methods from `section` instance to obtain items. You must use exported functions from this library for that."})}function transformDataItems(e,t,r,n){var i;n=n||0,r||_.each(e,function(e){if(!_.has(e,"template"))throw"You must to set defaultItemTemplate for section or for each items"}),t>n&&(i=e.splice(n,t-n));var o=_.chain(e).groupBy(function(e,r){return Math.floor(r/t)}).toArray().value();return i&&o.unshift(i),_.map(o,function(e){for(var t={template:"extlist@"+_.map(e,function(e){return e.template||r}).join(exports.DIVIDER),properties:{originalItems:e,height:Ti.UI.SIZE}},n=0,i=e.length;i>n;n++){var o=e[n];for(var s in o)"properties"!=s&&"template"!=s&&(t[s+exports.DIVIDER+n]=o[s]);o.properties&&(t["itemContainer@"+n]=o.properties)}return t})}function transformTemplates(e,t){function r(e,t,n){n=n||0,e.bindId?2!==e.bindId.split(exports.DIVIDER).length&&(e.bindId=e.bindId+t):e.bindId="_"+n++ +t,e.childTemplates&&_.each(e.childTemplates,function(e){r(e,t,n)})}function n(e,t){for(var r=[];t--;)r.push(e);return r.reduceRight(function(e,t){var r=[];return t.forEach(function(t){e.forEach(function(e){r.push([t].concat(e))})}),r})}for(var i=Object.keys(e),o=[],s=1;t>=s;s++)o.push.apply(o,_.chain(n(i,s)).map(function(t,n){_.isArray(t)||(t=[t]);var o="extlist@"+t.join(exports.DIVIDER),s={type:"Ti.UI.View",bindId:"rowContainer@"+n,properties:{layout:"horizontal",horizontalWrap:!1,width:Ti.UI.FILL,height:Ti.UI.SIZE}},a={properties:{name:o},childTemplates:[s]};return 1==i.length&&_.extend(a.properties,_.omit(clone(e[i[0]].properties),"name")),s.childTemplates=_.map(t,function(t,n){var i={type:"Ti.UI.View",bindId:"itemContainer@"+n,properties:{height:Ti.UI.SIZE,width:Ti.UI.SIZE,left:0}},o=e[t].childTemplates;return o&&(o=clone(o,"tiProxy"),i.childTemplates=o),r(i,exports.DIVIDER+n),i}),[o,a]}).value());return _.object(o)}function processTemplate(e){var t=Titanium.UI.createListItem();e.tiProxy=t;var r=e.events;addEventListeners(r,t)}function processChildTemplates(e){if(e.hasOwnProperty("childTemplates")){var t=e.childTemplates;if(void 0!==t&&null!==t)for(var r=0;r<t.length;r++){var n=t[r],i=n.type;if(void 0!==i&&void 0===n.tiProxy){var o,s=n.properties,a=lookup(i);o=void 0!==s?a(s):a();var p=n.events;addEventListeners(p,o),n.tiProxy=o}processChildTemplates(n)}}}function addEventListeners(e,t){if(void 0!==e)for(var r in e)t.addEventListener(r,e[r])}function lookup(name){var lastDotIndex=name.lastIndexOf("."),proxy=eval(name.substring(0,lastDotIndex));if(void 0!==typeof proxy){var proxyName=name.slice(lastDotIndex+1);return proxy["create"+proxyName]}}exports.createListView=function(e){if(e.sections&&_.each(e.sections,function(t){if(!e.columns)throw"You must define `columns` property in ListView. It can be same value or greater.";if(e.columns<t.columns)throw"ListView.columns property must be greater or equal ListViewSection.columns"}),!e.columns)return Ti.UI.createListView(e);e=_.extend({},e);var t=e.columns||1;if(!_.isEmpty(e.templates)){var r=transformTemplates(e.templates,t);if(e.templates=_.extend({},e.templates,r),"android"==Ti.Platform.osname)for(var n in e.templates){var i=e.templates[n];processTemplate(i),processChildTemplates(i)}}return Ti.UI.createListView(e)},exports.createListSection=function(e){if(!e.columns)return Ti.UI.createListSection(e);var t=Ti.UI.createListSection(_.omit(e,"items"));return e.items&&this.setItems(t,e.items),t},exports.DIVIDER="@",exports.wrap=function(e){var t;"Ti.UI.ListSection"==e.apiName?t=["setItems","getItems","getItemAt","appendItems","insertItemsAt","replaceItemsAt","deleteItemsAt","updateItemAt"]:"Ti.UI.ListView"==e.apiName&&(t=["appendSection","setMarker","addMarker"]);var r=this;return t?_.extend({obj:e},_.chain(t).map(function(e){return[e,function(){return r[e].apply(r,[this.obj].concat(Array.prototype.slice.call(arguments)))}]}).object().value()):void 0},exports.appendSection=function(e,t,r){if(!e.columns)throw"You must define `columns` property in ListView. It can be same value or greater.";if(e.columns<t.columns)throw"ListView.columns property must be greater or equal ListViewSection.columns";e.appendSection(t,r)},exports.setMarker=_.partial(setAddMarker,"setMarker"),exports.addMarker=_.partial(setAddMarker,"addMarker"),exports.transformEvent=function(e,t){if(e.transformed!==!0){if("move"==e.type&&Ti.API.warn("targetItemIndex property was not corrected."),e.section){e.section;if(t=t||e.section.columns,t&&e.bindId){var r=e.bindId.split("@");2==r.length&&(e.bindId=r[0],e.hasOwnProperty("itemIndex")&&(e.itemIndex=e.itemIndex*t+parseInt(r[1])))}}["scrollend","scrollstart"].indexOf(e.type)>-1&&(t=t||e.firstVisibleSection.columns,t&&(e.firstVisibleItemIndex=e.firstVisibleItemIndex*t,e.visibleItemCount=Math.min(e.firstVisibleSection.getItems().length-e.firstVisibleItemIndex,e.visibleItemCount*t),e.firstVisibleItem=e.firstVisibleSection.getItemAt(e.firstVisibleItemIndex))),e.transformed=!0}},exports.setItems=function(e,t,r,n){r=r||e.columns,n=n||e.defaultItemTemplate,r&&(validateNotTransformedItems(t),t=transformDataItems(t,r,n)),e.setItems(t)},exports.getItems=function(e){return clone(Array.prototype.concat.apply([],_.map(e.getItems(),function(e){return e.properties.originalItems})))},exports.getItemAt=function(e,t,r){r=r||e.columns;var n=Math.floor(t/r),i=t%r;return e.getItems()[n].properties.originalItems[i]},exports.appendItems=function(e,t,r,n,i){if(n=n||e.columns,i=i||e.defaultItemTemplate,n){if(!t.length)return;validateNotTransformedItems(t);var o=0,s=e.getItems(),a=_.last(s);a&&(o=a.properties.originalItems.length%n),t=transformDataItems(t,n,i,o),a&&o&&e.updateItemAt(s.length-1,_.extend(clone(a),t.shift()))}e.appendItems(t,r)},exports.insertItemsAt=function(e,t,r,n,i,o){if(i=i||e.columns,o=o||e.defaultItemTemplate,i){if(!r.length)return;validateNotTransformedItems(r);var s=Math.floor(t/i),a=t%i,p=e.items;e.deleteItemsAt(s,p.length-s);var l=p.splice(s),m=Array.prototype.concat.apply([],_.map(l,function(e){return e.properties.originalItems}));m.splice.apply(m,[a,0].concat(r)),exports.appendItems(e,m,n,i,o)}else e.insertItemsAt(t,r,n)},exports.replaceItemsAt=function(e,t,r,n,i,o,s){if(o=o||e.columns,s=s||e.defaultItemTemplate,o){r=r||0,validateNotTransformedItems(n);var a=Math.floor(t/o),p=t%o,l=e.getItems();e.deleteItemsAt(a,l.length-a,0===n.length?i:void 0);var m=l.splice(a),c=Array.prototype.concat.apply([],_.map(m,function(e){return e.properties.originalItems}));c.splice.apply(c,[p,r].concat(n)),exports.appendItems(e,c,0===n.length?void 0:i,o,s)}else e.appendItems(t,r,n,i)},exports.deleteItemsAt=function(e,t,r,n,i,o){i=i||e.columns,o=o||e.defaultItemTemplate,i?exports.replaceItemsAt(e,t,r,[],n,i,o):e.deleteItemsAt(t,r,n)},exports.updateItemAt=function(e,t,r,n,i,o){if(i=i||e.columns,o=o||e.defaultItemTemplate,i){validateNotTransformedItems([r]);var s=Math.floor(t/i),a=t%i,p=e.getItemAt(s).properties.originalItems;p.splice(a,1,r);var l=transformDataItems(p,i,o);e.updateItemAt(s,l[0],n)}else e.updateItemAt(t,r,n)};